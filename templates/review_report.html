{% extends 'base.html' %}

{% block custom_head_content %}
<style>
.card {
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    transition: 0.3s;
    width: 100%;
}

.card:hover {
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
}

.container {
    padding: 2px 16px;
}

ul {
    margin-left: 26px;
}
</style>
{% endblock %}

{% block content%}
    <div  class="page-selector" data-page-name="code-review-report">

        <h3>Kuliza Code Review Reports</h3>
        </br>

        <div class="card">
          <!--img src="img_avatar.png" alt="Avatar" style="width:100%"-->
          <div class="container">
            <h6><b>Important numbers at company level</b></h6>
            <ul>
                <li>Total number of code pushed by developers: <span id="company_number_of_push"></span></li>
                <li>Total number of code review request raised: <span id="company_number_of_pr_raised"></span></li>
                <li>Total number of code reviewed: <span id="company_number_of_pr_reviewed"></span></li>
                <li>Total number of comments made on code review request: <span id="company_number_of_comments_on_pr"></span></li>
                <li>Total number of approvals on code reviews request: <span id="company_number_of_approvals_on_pr"></span></li>
            </ul>

            <h6><b>Some inference from above numbers</b></h6>
              <ul>
                <li>Percentage of code review request raised for code being pushed: <span id="raise_percentage"></span></li>
                <li>Percentage of code push that are being reviewed: <span id="review_percentage"></span></li>
            </ul>
          </div>
        </div>

        <br/>

        <div class="card">
          <!--img src="img_avatar.png" alt="Avatar" style="width:100%"-->
          <div class="container">
            <h6><b>Project Level Reports</b></h6>
            <span id="project_reports" class="elements"></span>
          </div>
        </div>

    </div>

	{% block script %}
	<script>
        function httpGet(url)
        {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", url, false ); // false for synchronous request
            xmlHttp.send( null );
            return xmlHttp.responseText;
        }

        var response = JSON.parse(httpGet('/code-repo-report/'));
        console.log(response);
        for (var key in response.company) {
            if (response.company.hasOwnProperty(key)) { // this will check if key is owned by data object and not by any of it's ancestors
                $('#company_' + key).html(response.company[key]);
            }
        }

        $('#raise_percentage').html((response.company.number_of_pr_raised/response.company.number_of_push * 100).toFixed(2) + " %");
        $('#review_percentage').html((response.company.number_of_pr_reviewed/response.company.number_of_pr_raised*100).toFixed(2) + " %");

        var order = ['number_of_push', 'number_of_pr_raised', 'number_of_pr_reviewed', 'number_of_comments_on_pr',
            'number_of_approvals_on_pr'];
        var texts = ['Number of code pushes', 'Number of code review requests', 'Number of code reviews done',
                    'Number of comments on code review request', 'Number of approvals on code review'];
        for (p in response.projects) {
            var reference_element = $(".elements").last();
            project_html = '<div class="element"><h6><b>' + response.projects[p] + '</b></h6><ul>';
            for (o in order) {
                console.log(response.project[order[o]]);
                project_html += '<li>' + texts[o] + ': <span>' + response.project[order[o]][response.projects[p]] + '</span></li>';
            }

            project_html += '<li>Percentage of code review request raised for code being pushed: <span>' + (response.project.number_of_pr_raised[response.projects[p]]/response.project.number_of_push[response.projects[p]] * 100).toFixed(2) + " %" + '</span></li>';
            project_html += '<li>Percentage of code push that are being reviewed: <span>' + (response.project.number_of_pr_reviewed[response.projects[p]]/response.project.number_of_pr_raised[response.projects[p]]*100).toFixed(2) + " %" + '</span></li>';
            project_html += '</ul></div>';
            reference_element.after(project_html);
        }

	</script>
	{% endblock script %}
{% endblock %}


